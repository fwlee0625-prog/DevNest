# Supabase ç™»å½•åŠŸèƒ½è®¾ç½®æŒ‡å—

## ğŸ“‹ å‰ææ¡ä»¶

å·²å®‰è£…çš„ä¾èµ–ï¼š

- `@supabase/supabase-js` âœ…

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1ï¸âƒ£ é…ç½® Supabase é¡¹ç›®

1. è®¿é—® [supabase.com](https://supabase.com) å¹¶ç™»å½•
2. åˆ›å»ºæ–°é¡¹ç›®æˆ–é€‰æ‹©ç°æœ‰é¡¹ç›®
3. è¿›å…¥ **Settings** â†’ **API**
4. å¤åˆ¶ä»¥ä¸‹ä¿¡æ¯ï¼š
   - **Project URL**
   - **anon public key**

### 2ï¸âƒ£ é…ç½®ç¯å¢ƒå˜é‡

ç¡®ä¿ä½ çš„ `.env.local` æ–‡ä»¶åŒ…å«ä»¥ä¸‹å†…å®¹ï¼š

```bash
NEXT_PUBLIC_SUPABASE_URL=ä½ çš„é¡¹ç›®URL
NEXT_PUBLIC_SUPABASE_ANON_KEY=ä½ çš„å…¬é’¥
```

### 3ï¸âƒ£ åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼ˆadmin/admin123ï¼‰

æœ‰ä¸¤ç§æ–¹å¼åˆ›å»ºæµ‹è¯•ç”¨æˆ·ï¼š

#### æ–¹å¼ Aï¼šä½¿ç”¨ Supabase SQL ç¼–è¾‘å™¨ï¼ˆæ¨èï¼‰

1. åœ¨ Supabase Dashboard ä¸­ï¼Œè¿›å…¥ **SQL Editor**
2. æ‰§è¡Œä»¥ä¸‹ SQL åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·ï¼š

```sql
-- æ³¨æ„ï¼šè¿™ä¼šç›´æ¥åœ¨ auth.users è¡¨ä¸­åˆ›å»ºç”¨æˆ·
-- é‚®ç®±ä½¿ç”¨ admin@local.app æ ¼å¼ï¼ˆå¯¹åº”ç”¨æˆ·å adminï¼‰

INSERT INTO auth.users (
  instance_id,
  id,
  aud,
  role,
  email,
  encrypted_password,
  email_confirmed_at,
  raw_user_meta_data,
  created_at,
  updated_at,
  confirmation_token,
  recovery_token
) VALUES (
  '00000000-0000-0000-0000-000000000000',
  gen_random_uuid(),
  'authenticated',
  'authenticated',
  'admin@local.app',
  crypt('admin123', gen_salt('bf')),
  now(),
  '{"username": "admin", "avatar_url": "https://api.dicebear.com/7.x/avataaars/svg?seed=admin"}'::jsonb,
  now(),
  now(),
  '',
  ''
);
```

#### æ–¹å¼ Bï¼šä½¿ç”¨åº”ç”¨çš„æ³¨å†ŒåŠŸèƒ½

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`pnpm dev`
2. åˆ›å»ºæ³¨å†Œé¡µé¢ï¼ˆå¯é€‰ï¼Œå¦‚æœè¿˜æ²¡æœ‰ï¼‰
3. ä½¿ç”¨ä»¥ä¸‹ä¿¡æ¯æ³¨å†Œï¼š
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`
   - é‚®ç®±ä¼šè‡ªåŠ¨ç”Ÿæˆä¸ºï¼š`admin@local.app`

### 4ï¸âƒ£ é…ç½® Supabase é‚®ç®±éªŒè¯ï¼ˆå¯é€‰ï¼‰

å¦‚æœä½ å¸Œæœ›åœ¨å¼€å‘ç¯å¢ƒä¸­è·³è¿‡é‚®ç®±éªŒè¯ï¼š

1. è¿›å…¥ **Authentication** â†’ **Settings**
2. æ‰¾åˆ° **Email Auth** éƒ¨åˆ†
3. å…³é—­ **Enable email confirmations**

è¿™æ ·ç”¨æˆ·æ³¨å†Œåå¯ä»¥ç«‹å³ç™»å½•ï¼Œæ— éœ€éªŒè¯é‚®ç®±ã€‚

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
src/
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ supabase.ts              # Supabase å®¢æˆ·ç«¯é…ç½®
â”œâ”€â”€ services/
â”‚   â””â”€â”€ authService.ts           # è®¤è¯æœåŠ¡ï¼ˆç™»å½•ã€æ³¨å†Œã€ç™»å‡ºï¼‰
â”œâ”€â”€ hooks/
â”‚   â””â”€â”€ useAuth.ts               # è®¤è¯ Hook
â”œâ”€â”€ types/
â”‚   â””â”€â”€ auth.ts                  # è®¤è¯ç›¸å…³ç±»å‹å®šä¹‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â””â”€â”€ Header.tsx           # å¯¼èˆªæ ï¼ˆå«ç”¨æˆ·çŠ¶æ€ï¼‰
â”‚   â””â”€â”€ ui/
â”‚       â””â”€â”€ UserMenu.tsx         # ç”¨æˆ·å¤´åƒä¸‹æ‹‰èœå•
â””â”€â”€ app/
    â””â”€â”€ login/
        â””â”€â”€ page.tsx             # ç™»å½•é¡µé¢
```

## ğŸ¯ åŠŸèƒ½è¯´æ˜

### å·²å®ç°çš„åŠŸèƒ½

âœ… **ç”¨æˆ·å+å¯†ç ç™»å½•**

- ç”¨æˆ·åä¼šè‡ªåŠ¨æ˜ å°„ä¸ºé‚®ç®±æ ¼å¼ï¼ˆ`ç”¨æˆ·å@local.app`ï¼‰
- æ”¯æŒè¡¨å•éªŒè¯å’Œé”™è¯¯æç¤º
- åŠ è½½çŠ¶æ€æ˜¾ç¤º

âœ… **ç”¨æˆ·çŠ¶æ€ç®¡ç†**

- ä½¿ç”¨ `useAuth` Hook ç®¡ç†å…¨å±€è®¤è¯çŠ¶æ€
- è‡ªåŠ¨ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
- æŒä¹…åŒ–ä¼šè¯ï¼ˆåˆ·æ–°é¡µé¢ä¿æŒç™»å½•ï¼‰

âœ… **ç”¨æˆ·ç•Œé¢**

- æœªç™»å½•ï¼šæ˜¾ç¤º"ç™»å½•"æŒ‰é’®
- å·²ç™»å½•ï¼šæ˜¾ç¤ºç”¨æˆ·å¤´åƒ
- å¤´åƒæ‚¬æµ®ï¼šæ˜¾ç¤ºä¸‹æ‹‰èœå•ï¼ˆè´¦æˆ·è®¾ç½®ã€é€€å‡ºç™»å½•ï¼‰

âœ… **é€€å‡ºç™»å½•**

- ä¸€é”®é€€å‡º
- æ¸…é™¤ä¼šè¯çŠ¶æ€
- è‡ªåŠ¨è·³è½¬é¦–é¡µ

### ç”¨æˆ·åæ˜ å°„æœºåˆ¶

ç”±äº Supabase é»˜è®¤ä½¿ç”¨é‚®ç®±ä½œä¸ºç”¨æˆ·æ ‡è¯†ï¼Œæœ¬é¡¹ç›®é‡‡ç”¨ä»¥ä¸‹æ˜ å°„æ–¹æ¡ˆï¼š

- **ç”¨æˆ·å** â†’ **é‚®ç®±æ ¼å¼**ï¼š`admin` â†’ `admin@local.app`
- **ç”¨æˆ·åå­˜å‚¨**ï¼šä¿å­˜åœ¨ `user_metadata.username` å­—æ®µ
- **å¤´åƒç”Ÿæˆ**ï¼šä½¿ç”¨ [DiceBear Avatars](https://dicebear.com/) æ ¹æ®ç”¨æˆ·åç”Ÿæˆ

## ğŸ§ª æµ‹è¯•ç™»å½•

1. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š

```bash
pnpm dev
```

2. è®¿é—®ç™»å½•é¡µé¢ï¼š`http://localhost:3000/login`

3. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•ï¼š
   - ç”¨æˆ·åï¼š`admin`
   - å¯†ç ï¼š`admin123`

4. ç™»å½•æˆåŠŸåï¼š
   - è‡ªåŠ¨è·³è½¬åˆ°é¦–é¡µ
   - Header å³ä¸Šè§’æ˜¾ç¤ºç”¨æˆ·å¤´åƒ
   - ç‚¹å‡»å¤´åƒæŸ¥çœ‹ä¸‹æ‹‰èœå•
   - å¯ä»¥é€€å‡ºç™»å½•

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q: ç™»å½•æ—¶æç¤º"Invalid login credentials"ï¼Ÿ

A: è¯·ç¡®ä¿ï¼š

1. å·²åœ¨ Supabase ä¸­åˆ›å»ºäº†ç”¨æˆ·
2. é‚®ç®±æ ¼å¼æ­£ç¡®ï¼ˆ`admin@local.app`ï¼‰
3. å¯†ç æ­£ç¡®ï¼ˆ`admin123`ï¼‰
4. é‚®ç®±å·²éªŒè¯æˆ–å…³é—­äº†é‚®ç®±éªŒè¯è¦æ±‚

### Q: ç¯å¢ƒå˜é‡ä¸ç”Ÿæ•ˆï¼Ÿ

A:

1. ç¡®ä¿ `.env.local` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•
2. é‡å¯å¼€å‘æœåŠ¡å™¨ï¼ˆ`pnpm dev`ï¼‰
3. æ£€æŸ¥å˜é‡åæ˜¯å¦ä»¥ `NEXT_PUBLIC_` å¼€å¤´

### Q: å¦‚ä½•æ·»åŠ æ›´å¤šç”¨æˆ·ï¼Ÿ

A: æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. åœ¨ Supabase Dashboard çš„ Authentication â†’ Users ä¸­æ‰‹åŠ¨æ·»åŠ 
2. ä½¿ç”¨ SQL ç¼–è¾‘å™¨æ‰§è¡Œ INSERT è¯­å¥ï¼ˆå‚è€ƒä¸Šæ–‡ï¼‰
3. åˆ›å»ºæ³¨å†Œé¡µé¢è®©ç”¨æˆ·è‡ªè¡Œæ³¨å†Œ

## ğŸ“š æ‰©å±•åŠŸèƒ½

å¦‚éœ€å®ç°æ›´å¤šåŠŸèƒ½ï¼Œå¯å‚è€ƒä»¥ä¸‹æ–¹æ¡ˆï¼š

- **ç¬¬ä¸‰æ–¹ç™»å½•**ï¼šGoogle, GitHub ç­‰ OAuth ç™»å½•
- **æ³¨å†ŒåŠŸèƒ½**ï¼šä½¿ç”¨ `AuthService.register()` æ–¹æ³•
- **æ‰¾å›å¯†ç **ï¼šä½¿ç”¨ Supabase çš„å¯†ç é‡ç½®åŠŸèƒ½
- **ç”¨æˆ·æƒé™**ï¼šåœ¨ `user_metadata` ä¸­æ·»åŠ  `role` å­—æ®µ
- **ç”¨æˆ·èµ„æ–™**ï¼šåˆ›å»º `profiles` è¡¨å­˜å‚¨æ›´å¤šç”¨æˆ·ä¿¡æ¯

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Supabase è®¤è¯æ–‡æ¡£](https://supabase.com/docs/guides/auth)
- [Next.js ç¯å¢ƒå˜é‡](https://nextjs.org/docs/basic-features/environment-variables)
- [DiceBear Avatars](https://dicebear.com/)
